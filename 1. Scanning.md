# NMap - For Scanning


### What is Nmap?
> Nmap (network mapper), the god of port scanners used for network discovery and the basis for most security enumeration during the initial stages of a penetration test. 

### What does Nmap do:

- Host discovery
- Port discovery / enumeration
- Service discovery
- Operating system version detection
- Hardware (MAC) address detection
- Service version detection
- Vulnerability / exploit detection, using Nmap scripts (NSE)
- Nmap IDS / Portscan Detection & Scan Time Optimisation



```sh
nmap -sT -p- 10.10.91.123
sudo nmap -sS -A -O -sV -p21,22,80,111,2049,34495,49606,55048,60604 10.10.91.123
nmap --min-rate 4000 -p- 10.10.16.106

```

| Command | Description |
| --- | --- |
| nmap -sP 10.0.0.0/24  | Nmap scan the network, listing machines that respond to ping. |
| nmap -p 1-65535 -sV -sS -T4 target | A full TCP port scan using with service version detection - T1-T5 is the speed of the scan. |
| nmap -v -sS -A -T4 target | Prints verbose output, runs stealth syn scan, T4 timing, OS and version detection + traceroute and scripts against target services.
 |
| git diff | Show file differences that haven't been staged |
| git status | List all new or modified files |
| git diff | Show file differences that haven't been staged |
| git status | List all new or modified files |
| git diff | Show file differences that haven't been staged |
| git status | List all new or modified files |
| git diff | Show file differences that haven't been staged |
| git status | List all new or modified files |
| git diff | Show file differences that haven't been staged |
| git status | List all new or modified files |
| git diff | Show file differences that haven't been staged |
| git status | List all new or modified files |
| git diff | Show file differences that haven't been staged |

                 # 


	




	


nmap -v -sS -A -T5 target
	

Prints verbose output, runs stealth syn scan, T5 timing, OS and version detection + traceroute and scripts against target services.

nmap -v -sV -O -sS -T5 target
	

Prints verbose output, runs stealth syn scan, T5 timing, OS and version detection.

nmap -v -p 1-65535 -sV -O -sS -T4 target
	

Prints verbose output, runs stealth syn scan, T4 timing, OS and version detection + full port range scan.

nmap -v -p 1-65535 -sV -O -sS -T5 target
	

Prints verbose output, runs stealth syn scan, T5 timing, OS and version detection + full port range scan.

```

---

## NMap command cheat sheet
Nmap Cheatsheet

    Target Specification
    Host Discovery
    Scan Techniques
    Port Specification and Scan Order
    Service Version Detection
    Script Scan
    OS Detection
    Timing and Performance
    Firewalls IDS Evasion and Spoofing
    Nmap Scan Output File Options
    Misc Nmap Options

---

### General commands

* -sn: Disables port scan.
* -v: Enables the verbose output (include all hosts and ports in the output).
* -sV: Detects service versions.
* -A: Enables aggressive scan. The aggressive scan option supports OS detection (-O), version scanning (-sV), script scanning (-sC), and traceroute (--traceroute). You should not use -A against target networks without permission.
* -p: Specifies the port to be scanned.
* -O: OS detection.

---

> Nmap Commands

### Ping Sweep Scan
Discover the available hosts and their IP and MAC addresses, but no information about the ports.

```sh
nmap -sP [Target IP Address/Range of IP addresses]
```

---

> Host Discovery

### ARP ping scan

```sh
nmap -sn -PR [Target IP Address/Range of IP addresses]
```

### UDP ping scan

A UDP response means that the host is active. If the target host is offline or unreachable, various error messages such as “host/network unreachable” or “TTL exceeded” could be returned.
```sh
nmap -sn -PU [Target IP Address/Range of IP addresses]
```

### ICMP ECHO ping scan

The ICMP ECHO ping scan involves sending ICMP ECHO requests to a host. If the target host is alive, it will return an ICMP ECHO reply. This scan is useful for locating active devices or determining if the ICMP is passing through a firewall.

```sh
nmap -sn -PE [Target IP Address/Range of IP addresses]
```

### Alternative to ICMP ECHO ping scan: ICMP Timestamp and Address Mask Ping Scan

#### ICMP timestamp ping scan
```sh
nmap -sn -PP [Target IP Address/Range of IP addresses]
```

#### ICMP address mask ping scan
```sh
nmap -sn -PM [Target IP Address/Range of IP addresses]
```

#### TCP ACK Ping Scan
This technique sends empty TCP ACK packets to the target host; an RST response means that the host is active.

```sh
nmap -sn -PA [Target IP Address/Range of IP addresses]
```

### IP Protocol Ping Scan
This technique sends different probe packets of different IP protocols to the target host, any response from any probe indicates that a host is active.
```sh
nmap -sn -PO [Target IP Address/Range of IP addresses]
```

---

> Nmap Scan Techniques

### TCP connect/full open scan
```sh
nmap -sT -v [Target IP Address/Range of IP addresses]
```

### Stealth scan/TCP half-open scan
This scanning technique can be used to bypass firewall rules, logging mechanisms, and hide under network traffic.
```sh
nmap -sS -v [Target IP Address/Range of IP addresses]
```

### Xmas scan
Sends a TCP frame to a target system with FIN, URG, and PUSH flags set. If the target has opened the port, then you will receive no response from the target system. If the target has closed the port, then you will receive a target system reply with an RST.
```sh
nmap -sX -v [Target IP Address/Range of IP addresses]
```

### TCP Maimon scan
FIN/ACK probe is sent to the target; if there is no response, then the port is Open|Filtered, but if the RST packet is sent as a response, then the port is closed.
```sh
nmap -sM -v [Target IP Address/Range of IP addresses]
```

### ACK flag probe scan
Sends an ACK probe packet with a random sequence number; no response implies that the port is filtered (stateful firewall is present), and an RST response means that the port is not filtered.
```sh
nmap -sA -v [Target IP Address/Range of IP addresses]
```

### UDP scan
Uses UDP protocol instead of the TCP. There is no three-way handshake for the UDP scan. It sends UDP packets to the target host; no response means that the port is open. If the port is closed, an ICMP port unreachable message is received.
```sh
nmap -sU -v [Target IP Address/Range of IP addresses]
```

### IDLE/IPID Header Scan / Zombie Scan
A TCP port scan method that can be used to send a spoofed source address to a computer to discover what services are available.
```sh
nmap -sI -v [Target IP Address/Range of IP addresses]
```

Reference: https://nmap.org/book/idlescan.html

### SCTP COOKIE ECHO Scan
A COOKIE ECHO chunk is sent to the target host; no response implies that the port is open and ABORT Chunk response means that the port is closed.
```sh
nmap -sZ -v [Target IP Address/Range of IP addresses]
```


---

> Timing and Performance and Misc Nmap Options
>
### Display the open ports and services running 

```sh
nmap -T4 -A -v [Target IP Address/Range of IP addresses]
```

- T4: Specifies setting time template (0-5).
- A: Specifies setting ACK flag.

---

> OS Detection

```sh
nmap -v -sV -O -sS -T5 target
```

- O : Enable OS Detection

---

> Service Version Detection and Script Scan

### smb-os-discovery
Attempts to determine the OS, computer name, domain, workgroup, and current time over the SMB protocol
```sh
nmap --script smb-os-discovery.nse [Target IP Address/Range of IP addresses]
```


### NetBIOS enumeration
```sh
nmap -sV -v --script nbstat.nse [Target IP Address/Range of IP addresses]
```

### Http enum - enumerate the applications, directories, and files in a web server
```sh
nmap -sV --script http-enum [Target IP Address/Range of IP addresses]
```

### hostmap-bfk
```sh
nmap --script hostmap-bfk -script-args hostmap-bfk.prefix=hostmap- [Target IP Address/Range of IP addresses]
```

### Http trace
Uses the TRACE method by sending an HTTP TRACE request that shows if the method is enabled or not
```sh
nmap --script http-trace -d [Target IP Address/Range of IP addresses]
```

### Http frontpage login
```sh
nmap [Target IP Address/Range of IP addresses] -p 80 --script = http-frontpage-login
```

### Http passwd
```sh
nmap --script http-passwd --script-args http-passwd.root =/ [Target IP Address/Range of IP addresses]
```

### Check whether Web Application Firewall is configured on the target host or domain
```sh
nmap -p80 --script http-waf-detect [Target IP Address/Range of IP addresses]
```

---

> Firewalls IDS Evasion and Spoofing
> 
### Bypassing firewall/IDS

#### Fragment packets
Send fragmented probe packets to the intended target, which re-assembles it after receiving all the fragments.
```sh
nmap -f [Target IP Address/Range of IP addresses]
```

#### Source port manipulation
Manipulating actual port numbers with common port numbers to evade IDS/firewall (sometimes, firewall is configured to allow packets from well-known ports like HTTP, DNS, FTP, etc.).
```sh
nmap -g 80 [Target IP Address/Range of IP addresses]
```

#### Set number of Maximum Transmission Unit (MTU)
This technique evades the filtering and detection mechanism enabled in the target machine.
```sh
nmap -mtu 8 [Target IP Address/Range of IP addresses]
```

#### Decoy
Generating or manually specifying IP addresses of the decoys to evade IDS/firewall. Nmap automatically generates a random number of decoys for the scan and randomly positions the real IP address between the decoy IP addresses.

-D: performs a decoy scan.
RND: generates a random and non-reserved IP addresses.
```sh
nmap -D RND:10 [Target IP Address/Range of IP addresses]
```

#### Send the binary data as payload

```sh
nmap [Target IP Address/Range of IP addresses] --data 0xdeadbeef
```

#### Send string data as payload
```sh
nmap [Target IP Address/Range of IP addresses] --data-string "dummy string"
```

#### Append the number of random data bytes to most of the packets sent without any protocol-specific payloads

```sh
nmap --data-length 5 [Target IP Address/Range of IP addresses]
```

#### Scan in random order

```sh
nmap --randomize-hosts [Target IP Address/Range of IP addresses]
```

#### Send the packets with bad or bogus TCP/UPD checksums
```sh
nmap --badsum [Target IP Address/Range of IP addresses]
```

#### Send the packets with bad or bogus TCP/UPD checksums
```sh
nmap --badsum [Target IP Address/Range of IP addresses]
```

---

> Misc Nmap Options

### Scanning for vulneabilities

#### Identify the IPv6 capabilities of a device
```sh
nmap -6 -n -Pn -sSU -pT:0-65535,U:0-65535 -v -A -oX [NAME] [Target IP Address/Range of IP addresses]
```

#### Check for open TCP and UDP services and ports
```sh
nmap -n -Pn -sSU -pT:0-65535,U:0-65535 -v -A -oX [NAME] [Target IP Address/Range of IP addresses]
```

#### Scan for a specific IP address
```sh
nmap -n -Pn -sS -pT:0-65535 -v -A -oX [Target IP Address/Range of IP addresses]
```

---

> Enumeration ICS/SCADA systems

### Scanning ICS/SCADA systems

#### Identifying HMI systems
```sh
nmap -Pn -sT -p 46824 [Target IP address/Range of IP addresses]
```  

#### Identifyng open ports and services
```sh
nmap -Pn -sT --scan-delay 1d --mac-parallelism 1 -p [port list] [Target IP address/Range of IP addresses]
```

#### Scanning siemens SIMATIC S7 PLCs
```sh
nmap -Pn -sT -p 102 --script s7-info [Target IP address/Range of IP addresses]
```

#### Scanning ethernet/IP devices
```sh
nmap -Pn -sU -p 44818 --script enip-info [Target IP address/Range of IP addresses]
```

#### Scanning modbus devices
```sh
nmap -Pn -sT -p 502 --script modbus-discover [Target IP address/Range of IP addresses]
```

#### Scanning BACnet devices
```sh
nmap -Pn -sU -p 47808 --script bacnet-info [Target IP address/Range of IP addresses]
```

#### Scanning Niagara Fox devices
```sh
nmap -Pn -sT -p 1911,4911 --script fox-info [Target IP address/Range of IP addresses]
```

#### Scanning Omron PLC devices
```sh
nmap -Pn -sT -p 9600 --script omron-info [Target IP address/Range of IP addresses]
```

#### Scanning PCWorx devices
```sh
nmap -Pn -sT -p 1962 --script pcworx-info [Target IP address/Range of IP addresses]
```

#### Scanning ProConOS devices
```sh
nmap -Pn -sT -p 20547 --script proconos-info [Target IP address/Range of IP addresses]
```



### Protection

#### Promiscuous detection
```sh
nmap --script=sniffer-detect [Target IP Address/Range of IP addresses]
```


[<- Back to index](README.md)

---

Reference:
1. [nmap-cheat-sheet.md by Lifka](https://github.com/Lifka/hacking-resources/blob/main/nmap-cheat-sheet.md)
2. Stationx: https://www.stationx.net/nmap-cheat-sheet/
3. [Nmap Cheat Sheet: Commands, Flags, Switches & Examples (2024)](https://highon.coffee/blog/nmap-cheat-sheet/)
