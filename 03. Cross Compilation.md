# Cross compilation is an essential skill 

Whilst cross-compilation is a very useful skill to have, it's often difficult to get completely correct. Ideally we should always try to compile our code in an environment as close to the target environment as possible. For example, if an exploit or program is designed to work on CentOS 7.2, we should try to compile it in a CentOS 7.2 VM if possible. Equally, it's essential that we get the same arch as that of the target -- a 64 bit program won't work very well on a 32 bit target!

Sometimes it's easiest to just cross-compile, however. Generally speaking we cross compile x64 Windows programs on Kali using the mingw-w64 package (for x64 systems). This is not installed on Kali by default, however it is available in the Kali apt repositories:

`sudo apt install mingw-w64`

Much like we use `gcc` to compile binaries on Linux, we can use the `mingw` compilers to compile Windows binaries. These tend to have very descriptive (read: long) names, but the one that's of particular importance to us here is `x86_64-w64-mingw32-gcc`. This specifies that we want to compile a 64bit binary.

---

We then compile it with mingw like this:
```sh
> Windows 32 bit
i686-w64-mingw32-gcc [input file: source] –o [output file: .exe] –lws2_32
i686-w64-mingw32-gcc 40564.c –o exploit.exe –lws2_32

# e.g.
i686-w64-mingw32-gcc windows-exp.c -lws2_32 -o exp.exe

> For 64 bit architecture

x86_64-w64-mingw32-gcc -shared -o legit.dll legit.c
x86_64-w64-mingw32-gcc windows_service.c -o x.exe 
```

![Mingw-w64](https://github.com/khansiddique/pentesting-repo-notes/blob/main/Images/Compile-Windows-x64-exploit-with-Mingw64.jpg)

> DLL File compile
```sh
// For x64 compile with:
x86_64-w64-mingw32-gcc windows_dll.c -shared -o output.dll
// For x86 compile with:
i686-w64-mingw32-gcc windows_dll.c -shared -o output.dll
``` 

# Mingw-w64: How to compile Windows exploits on Kali Linux


# Reference:

1. [Mingw-w64: How to compile Windows exploits on Kali Linux](https://www.hackingtutorials.org/exploit-tutorials/mingw-w64-how-to-compile-windows-exploits-on-kali-linux/)
